<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.marroticket.mapper.TmemberMapper">
	<!-- TmemberVO resultmap 정의 -->
	<resultMap
		type="com.marroticket.tmember.member.domain.TmemberVO" id="tmemberMap">
		<id property="tNumber" column="t_number" />
		<result property="tId" column="t_id" />
		<result property="tPassword" column="t_password" />
		<result property="tName" column="t_name" />
		<result property="tAddress" column="t_address" />
		<result property="tOwnerName" column="t_ownerName" />
		<result property="tOwnerPhoneNumber"
			column="t_ownerPhoneNumber" />
		<result property="tOwnerEmail" column="t_ownerEmail" />
		<result property="tBusinessRegistractionNumber"
			column="t_businessRegistractionNumber" />
		<result property="tEstablishmentDate"
			column="t_establishmentDate" />
		<result property="tBank" column="t_bank" />
		<result property="tBankNumber" column="t_bankNumber" />
		<result property="tBankOwner" column="t_bankOwner" />
		<result property="tBusinessRegistrationImageUrl"
			column="t_businessRegistrationImageurl" />
		<result property="tAuth" column="t_auth" />
		<result property="tAgree" column="t_agree" />
		<collection property="tmemberAuthList" resultMap="authMap" />
	</resultMap>
	<!-- TmemberAuth resultmap 정의 -->
	<resultMap
		type="com.marroticket.tmember.member.domain.TmemberAuth" id="authMap">
		<result property="tNumber" column="t_number" />
		<result property="tmemberAuth" column="tmember_auth" />
	</resultMap>

	<resultMap id="payment"
		type="com.marroticket.admin.payment.domain.PaymentVO">
		<result property="payNumber" column="pay_Number" />
		<result property="pNumber" column="p_Number" />
		<result property="tNumber" column="t_Number" />
		<result property="payTheaterPayment"
			column="pay_TheaterPayment" />
		<result property="paySitePayment" column="pay_SitePayment" />
		<result property="payPayment" column="pay_Payment" />
		<result property="payPayDate" column="pay_PayDate" />
		<result property="payCalculateDate" column="pay_Calculate" />
		<result property="tName" column="t_Name" />
		<result property="pName" column="p_Name" />
		<result property="pCloseDate" column="p_CloseDate" />

	</resultMap>

	<!--극단 아이디 찾기 -->
	<select id="findId" resultType="String">
		SELECT t_id
		FROM tmember
		WHERE
		t_name = #{tName} and t_owneremail = #{tOwnerEmail}
	</select>
	<!--극단회원 비밀번호 업데이트 -->
	<update id="updatePassword"
		parameterType="com.marroticket.tmember.member.domain.TmemberVO">
		UPDATE tmember SET t_password = #{tPassword}
		WHERE t_id =
		#{tId} and t_owneremail = #{tOwnerEmail}
	</update>

	<!-- 아이디 읽어오기(로그인) -->
	<select id="readByUserId" resultMap="tmemberMap">
		SELECT mem.t_number,
		mem.t_id,
		t_password,
		t_name,
		t_address,
		t_ownername,
		t_ownerphonenumber,
		t_owneremail,
		t_businessregistration,
		t_businessregistrationnumber,
		t_establishmentdate,
		t_bank,
		t_banknumber,
		t_bankowner,
		t_businessregistrationimageUrl,
		t_auth,
		t_agree,
		tmember_auth
		FROM tmember
		mem LEFT OUTER JOIN tmember_auth auth ON
		mem.t_number = auth.t_number
		WHERE mem.t_id = #{tId}
	</select>

	<!-- 회원가입 -->
	<select id="tIdCheck" resultType="int">
		SELECT count(*)
		FROM tmember
		WHERE t_id = #{tId}
	</select>

	<insert id="create"
		parameterType="com.marroticket.tmember.member.domain.TmemberVO">
		INSERT INTO TMEMBER (
		t_number,
		t_id,
		t_password,
		t_name,
		t_address,
		t_ownername,
		t_ownerphonenumber,
		t_owneremail,
		t_businessregistration,
		t_businessregistrationnumber,
		t_establishmentdate,
		t_bank,
		t_banknumber,
		t_bankowner,
		t_businessregistrationimageurl,
		t_auth,
		t_agree
		)
		VALUES (
		tmember_seq.nextval,
		#{tId},
		#{tPassword},
		#{tName},
		#{tAddress},
		#{tOwnerName},
		#{tOwnerPhoneNumber},
		#{tOwnerEmail},
		#{tBusinessRegistration},
		#{tBusinessRegistractionNumber},
		#{tEstablishmentDate},
		#{tBank},
		#{tBankNumber},
		#{tBankOwner},
		#{tBusinessRegistrationImageUrl},
		#{tAuth},
		#{tAgree}
		)
	</insert>

	<!-- 회원가입 시 권한 부여 -->
	<insert id="createAuth">
		INSERT INTO tmember_auth
		(
		t_number,
		tmember_auth
		)
		VALUES
		(
		tmember_seq.CURRVAL,
		#{tmemberAuth}
		)
	</insert>

	<select id="theaterPayment" resultMap="payment">
		<![CDATA[
		select pay.*, 
       play.*,t.*
from payment pay, play play, tmember t
where pay.p_number = play.p_number
  and play.t_number = t.t_number and t_id = #{tId}
  order by pay_number desc
        
		]]>
	</select>

</mapper>