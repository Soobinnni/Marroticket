<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.marroticket.mapper.TmemberMapper">
		<!-- TmemberVO resultmap 정의 -->
	<resultMap type="com.marroticket.tmember.member.domain.TmemberVO" id="tmemberMap">
		<id property="tNumber" column="t_number" />
		<result property="tId" column="t_id" />
		<result property="tPassword" column="t_password" />
		<result property="tName" column="t_name" />
		<result property="tAddress" column="t_address" />
		<result property="tOwnerName" column="t_ownerName" />
		<result property="tOwnerPhoneNumber" column="t_ownerPhoneNumber" />
		<result property="tOwnerEmail" column="t_ownerEmail" />
		<result property="tBusinessRegistrationNumber" column="t_businessRegistrationNumber" />
		<result property="tEstablishmentDate" column="t_establishmentDate" />
		<result property="tBank" column="t_bank" />
		<result property="tBankNumber" column="t_bankNumber" />
		<result property="tBankOwner" column="t_bankOwner" />
		<result property="tBusinessRegisterationImage" column="t_businessRegisterationImage" />
		<result property="tFileUrl" column="t_fileUrl" />
		<result property="tFileName" column="t_fileName" />
		<result property="tAuth" column="t_auth" />
		<result property="tAgree" column="t_agree" />
		<collection property="tmemberAuthList" resultMap="authMap" />
	</resultMap>
	<!-- TmemberAuth resultmap 정의 -->
	<resultMap type="com.marroticket.tmember.member.domain.TmemberAuth" id="authMap">
		<result property="tNumber" column="t_number" />
		<result property="tmemberAuth" column="tmember_auth" />
	</resultMap>
	
	
	<!--극단 아이디 찾기-->
	<select id="findId" resultType="String">
		SELECT t_id
		FROM tmember
		WHERE t_name = #{tName} and t_owneremail = #{tOwnerEmail}
	</select>
	<!--극단회원 비밀번호 업데이트-->
	<update id="updatePassword" parameterType="com.marroticket.tmember.member.domain.TmemberVO">
		UPDATE tmember SET t_password = #{tPassword}
		WHERE t_id = #{tId} and t_owneremail = #{tOwnerEmail}
	</update>
		
	<!-- 아이디 읽어오기(로그인) -->
	<select id="readByUserId" resultMap="tmemberMap">
		SELECT mem.t_number,
		mem.t_id,
		t_password,
		t_name,
		t_address,
		t_ownername,
		t_ownerphonenumber,
		t_owneremail,
		t_businessregistration,
		t_businessregistrationnumber,
		t_establishmentdate,
		t_bank,
		t_banknumber,
		t_bankowner,
		t_businessregistrationimage,
		t_fileurl,
		t_filename,
		t_auth,
		t_agree,
		tmember_auth
		FROM tmember mem LEFT OUTER JOIN tmember_auth auth ON
		mem.t_number = auth.t_number
		WHERE mem.t_id = #{tId}
	</select>
	
	<!-- 회원가입 -->	
	<select id="tIdCheck" resultType="int">
		SELECT count(*)
		FROM tmember
		WHERE t_id = #{tId}
	</select>

	 <insert id="create"
		parameterType="com.marroticket.tmember.member.domain.TmemberVO">
		INSERT INTO TMEMBER (
		t_number,
		t_id,
		t_password,
		t_name,
		t_address,
		t_ownername,
		t_ownerphonenumber,
		t_owneremail,
		t_businessregistration,
		t_businessregistrationnumber,
		t_establishmentdate,
		t_bank,
		t_banknumber,
		t_bankowner,
		t_businessregistrationimage,
		t_fileurl,
		t_filename,
		t_auth,
		t_agree
		)
		VALUES (
		tmember_seq.nextval,
		#{tId},
		#{tPassword},
		#{tName},
		#{tAddress},
		#{tOwnerName},
		#{tOwnerPhoneNumber},
		#{tOwnerEmail},
		#{tBusinessRegistration},
		#{tBusinessRegistrationNumber},
		#{tEstablishmentDate},
		#{tBank},
		#{tBankNumber},
		#{tBankOwner},
		#{tBusinessRegisterationImage},
		#{tFileUrl},
		#{tFileName},
		#{tAuth},
		#{tAgree}
		)
	</insert>

	<!-- 회원가입 시 권한 부여 -->
	<insert id="createAuth">
		INSERT INTO tmember_auth
		(
			t_number,
			tmember_auth
		)
		VALUES
		(
			tmember_seq.CURRVAL,
			#{tmemberAuth}
		)
	</insert>	
	
	<!-- 마이페이지 회원정보 -->
	<select id="getTmemberByTId"  resultMap="tmemberMap">
	SELECT *
	FROM tmember
	WHERE t_id = #{tId}
	</select>
	
	<!-- 마이페이지 회원수정 -->
	<update id="updatetmemberInfo" >
		update TMEMBER 
		set t_password=#{tPassword},
			t_name=#{tName},
			t_address=#{tAddress},
			t_ownerName=#{tOwnerName},
			t_ownerPhoneNumber=#{tOwnerPhoneNumber},
			t_ownerEmail=#{tOwnerEmail},
			t_bank=#{tBank},
			t_bankNumber=#{tBankNumber},
			t_bankOwner=#{tBnakOwner}
		where t_id=#{tId}
	</update>
	
</mapper>